# name: test/sql/collect/test_collect.test
# description: Test to check ARRAY and MAP creation from query
# group: [collect]

statement ok
CREATE TABLE T1 (a INTEGER, b INTEGER);

statement ok
INSERT INTO T1 VALUES (11, 22), (11, 10), (12, 21);

query T
SELECT ARRAY_AGG(b ORDER BY b) as c FROM T1 GROUP BY a ORDER BY a
----
[10, 22]
[21]

query T
SELECT ARRAY(SELECT * FROM (SELECT 1 UNION SELECT 2 UNION SELECT 3))
----
[1, 2, 3]

query T
SELECT ARRAY[1, 2, 3]
----
[1, 2, 3]

query T
SELECT ARRAY_CONCAT_AGG(a) FROM (SELECT 1 as id, ARRAY[1, 2, 3] as a UNION SELECT 1 as id, ARRAY[4, 5, 6] as a) GROUP BY id
----
[1, 2, 3, 4, 5, 6]

query T
SELECT ARRAY_CONCAT_AGG(a ORDER BY rate DESC) FROM (SELECT 1 as id, ARRAY[1, 2, 3] as a, 2 as rate UNION SELECT 1 as id, ARRAY[4, 5, 6] as a, 1 as rate) GROUP BY id
----
[1, 2, 3, 4, 5, 6]

query T
SELECT ARRAY_CONCAT_AGG(a ORDER BY CARDINALITY(a)) FROM (SELECT 1 as id, ARRAY[3, 4, 5, 6] as a UNION SELECT 1 as id, ARRAY[1, 2] as a) GROUP BY id
----
[1, 2, 3, 4, 5, 6]

query T
SELECT MAP[1, 'test1', 2, 'test2', 3, 'test3']
----
{1:test1, 2:test2, 3:test3}

query T
SELECT MAP(SELECT * FROM (SELECT 1, 'test1' UNION SELECT 2, 'test2' UNION SELECT 3, 'test3'))
----
{1:test1, 2:test2, 3:test3}
