# name: test/sql/types/blob/test_blob_operator.test
# description: Test BLOBs with various SQL operators
# group: [blob]

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE blobs (bb BYTEA, g INTEGER);

# strings: hello -> \x68656C6C6F, r -> \x72
statement ok
INSERT INTO blobs VALUES ('hello', 0), ('\x00whatisgoingon', 1), (NULL, 0), ('\xFF\xFE\xFB', 1)

# simple aggregates only
query IITT
SELECT COUNT(*), COUNT(bb), MIN(bb), MAX(bb) FROM blobs
----
4	3	\x00whatisgoingon	\xFF\xFE\xFB

# ORDER BY
query TI
SELECT * FROM blobs ORDER BY bb
----
NULL	0
\x00whatisgoingon	1
hello	0
\xFF\xFE\xFB	1

# GROUP BY
statement ok
INSERT INTO blobs VALUES ('hello', 3), ('\x00whatisgoingon', 9), (NULL, 0), ('\xFF\xFE\xFB', 19)

query II
SELECT bb, SUM(g) FROM blobs GROUP BY bb ORDER BY bb
----
NULL	0
\x00whatisgoingon	10
hello	3
\xFF\xFE\xFB	20

# JOIN
statement ok
CREATE TABLE blobs2 (bb BYTEA, g INTEGER);

statement ok
INSERT INTO blobs2 VALUES ('hello', 0), ('\x00whatisgoingon', 100), (NULL, 0), ('\xFF\xFE\xFB', 200)

# group by blobs.bb, explicit JOIN
query TR
SELECT L.bb, SUM(L.g) FROM blobs as L JOIN blobs2 AS R ON L.bb=R.bb GROUP BY L.bb ORDER BY L.bb
----
\x00whatisgoingon	10.000000
hello	3.000000
\xFF\xFE\xFB	20.000000

# group by blobs2.bb, implicit JOIN
query TR
SELECT R.bb, SUM(R.g) FROM blobs as L, blobs2 AS R WHERE L.bb=R.bb GROUP BY R.bb ORDER BY R.bb
----
\x00whatisgoingon	200.000000
hello	0.000000
\xFF\xFE\xFB	400.000000

