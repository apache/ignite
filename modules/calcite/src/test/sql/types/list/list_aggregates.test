# name: test/sql/types/list/list_aggregates.test
# description: Test lists with aggregations
# group: [list]

require vector_size 512

statement ok
PRAGMA enable_verification

query II
select min(ii::varchar), max(ii::varchar) from range(10) tbl(ii);
----
0	9

query II
select min(list_value(ii)), max(list_value(ii)) from range(10) tbl(ii);
----
[0]	[9]

query I
select string_agg(list_value(ii), ',') from range(10) tbl(ii);
----
[0],[1],[2],[3],[4],[5],[6],[7],[8],[9]

# window aggregate
query III
select ii, ii % 2, min(list_value(ii)) over(partition by ii % 2 order by ii) from range(10) tbl(ii) ORDER BY 1;
----
0	0	[0]
1	1	[1]
2	0	[0]
3	1	[1]
4	0	[0]
5	1	[1]
6	0	[0]
7	1	[1]
8	0	[0]
9	1	[1]

# list
query III
select ii, ii % 2, list(ii) over(partition by ii % 2 order by ii) from range(10) tbl(ii) ORDER BY 2, 1;
----
0	0	[0]
2	0	[0, 2]
4	0	[0, 2, 4]
6	0	[0, 2, 4, 6]
8	0	[0, 2, 4, 6, 8]
1	1	[1]
3	1	[1, 3]
5	1	[1, 3, 5]
7	1	[1, 3, 5, 7]
9	1	[1, 3, 5, 7, 9]

query III
select ii, ii % 2, list(ii) over(partition by ii % 2 order by ii rows between 1 preceding and 1 following) from range(10) tbl(ii) ORDER BY 2, 1;
----
0	0	[0, 2]
2	0	[0, 2, 4]
4	0	[2, 4, 6]
6	0	[4, 6, 8]
8	0	[6, 8]
1	1	[1, 3]
3	1	[1, 3, 5]
5	1	[3, 5, 7]
7	1	[5, 7, 9]
9	1	[7, 9]
