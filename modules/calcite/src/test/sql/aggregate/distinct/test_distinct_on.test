# name: test/sql/aggregate/distinct/test_distinct_on.test
# description: Test DISTINCT ON
# group: [distinct]

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE integers(ii INTEGER, jj INTEGER, kk INTEGER);

statement ok
INSERT INTO integers VALUES (2, 3, 5), (4, 5, 6), (2, 7, 6)

query II
SELECT DISTINCT ON (ii) ii, jj FROM integers WHERE ii <> 2
----
4	5

query II
SELECT DISTINCT ON (jj) ii, jj FROM integers WHERE ii <> 2
----
4	5

query II
SELECT DISTINCT ON (jj, ii) ii, jj FROM integers WHERE ii <> 2
----
4	5

query II
SELECT DISTINCT ON (jj + 1, ii * 3) ii, jj FROM integers WHERE ii <> 2
----
4	5

query II
SELECT DISTINCT ON (1) ii, jj FROM integers ORDER BY ii
----
2	3
4	5

query II
SELECT DISTINCT ON (1) ii, jj FROM integers ORDER BY ii LIMIT 1
----
2	3

query II
SELECT DISTINCT ON (1) ii, jj FROM integers ORDER BY ii LIMIT 1 OFFSET 1
----
4	5

query II
SELECT DISTINCT ON (2) ii, jj FROM integers ORDER BY 2
----
2	3
4	5
2	7

query II
SELECT DISTINCT ON (2) jj, kk FROM integers ORDER BY 2
----
3	5
5	6

query III
SELECT DISTINCT ON (3) ii, jj, kk FROM integers ORDER BY 2
----
2	3	5
4	5	6

query III
SELECT DISTINCT ON (3) ii, jj, kk FROM integers ORDER BY 3
----
2	3	5
4	5	6

query II
SELECT DISTINCT ON (2) jj, (SELECT ii FROM integers) FROM integers ORDER BY 2
----
3	2

query II
SELECT DISTINCT ON (2) jj, (SELECT DISTINCT ON (ii) ii FROM integers ORDER BY 1) FROM integers ORDER BY 2
----
3	2

query II
SELECT DISTINCT ON (ii) ii, jj FROM integers ORDER BY jj
----
2	3
4	5

query II
SELECT * FROM (SELECT DISTINCT ON (ii) ii, jj FROM integers) tbl1 WHERE ii <> 2
----
4	5

# order by aa column that does not exist in the SELECT clause
query II
SELECT DISTINCT ON (ii) ii, jj FROM integers ORDER BY kk
----
2	3
4	5

# equivalent to this, but without projecting the kk
query III
SELECT DISTINCT ON (ii) ii, jj, kk FROM integers ORDER BY kk
----
2	3	5
4	5	6

# binding of DISTINCT ON with different column names
query II
SELECT DISTINCT ON (integers.ii) ii, jj FROM integers ORDER BY 1, 2
----
2	3
4	5

query II
SELECT DISTINCT ON (ii) integers.ii, integers.jj FROM integers ORDER BY 1, 2
----
2	3
4	5

query II
SELECT DISTINCT ON (integers.ii) integers.ii, integers.jj FROM integers ORDER BY ii, jj
----
2	3
4	5

# out of bounds
statement error
SELECT DISTINCT ON (2) ii FROM integers

