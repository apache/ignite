# name: test/sql/function/string/test_similar_to.test
# description: Test SIMILAR TO statement
# group: [string]

query T
SELECT 'aaa' SIMILAR TO 'bbb'
----
0

query T
SELECT 'aaa' SIMILAR TO 'aaa'
----
1

query T
SELECT 'aaa' SIMILAR TO '.*'
----
1

query T
SELECT 'aaa' SIMILAR TO 'aa.*'
----
1

query T
SELECT 'aaa' SIMILAR TO '.*aa'
----
1

query T
SELECT 'aaa' SIMILAR TO '.*bb'
----
0

query T
SELECT 'aaa' SIMILAR TO 'bb.*'
----
0

query T
SELECT 'aaa' SIMILAR TO 'aa[aa-z]aa'
----
1

query T
SELECT 'aaa' SIMILAR TO 'aa[aa-z]{2}'
----
1

query T
SELECT 'aaa' SIMILAR TO 'aa[aa-z].*'
----
1

query T
SELECT 'aaa' SIMILAR TO '[aa-z][aa-z].*'
----
1

query T
SELECT 'aaa' SIMILAR TO '[aa-z]{3}'
----
1

query T
SELECT 'aaa' NOT SIMILAR TO '[bb-z]{3}'
----
1

query T
SELECT 'aaa' ~ 'aaa'
----
1

query T
SELECT 'aaa' !~ 'bbb'
----
1

# similar to must match entire expression
query T
SELECT 'aaa' ~ '^aa'
----
0

query T
SELECT 'aaa' ~ '^aa+'
----
1

query T
SELECT 'aaa' ~ '(aa|bb)*'
----
1

query T
SELECT 'abc' ~ '^(bb|cc)'
----
0

# Test SIMILAR TO statement with expressions
statement ok
CREATE TABLE strings (s STRING, p STRING);

statement ok
INSERT INTO strings VALUES('aaa', 'aa[aa-z]aa'), ('abab', 'ab.*'), ('aaa', 'aa[aa-z]aa'), ('aaa', '.*bb.*');

statement ok


query T
SELECT s FROM strings WHERE s SIMILAR TO 'ab.*'
----
abab

query T
SELECT s FROM strings WHERE 'aba' SIMILAR TO p
----
aaa
abab
aaa
aaa

query T
SELECT s FROM strings WHERE s SIMILAR TO p
----
aaa
abab
aaa

query T
SELECT s FROM strings WHERE s NOT SIMILAR TO p
----
aaa

# invalid SIMILAR TO expression
statement error
SELECT s FROM strings WHERE s SIMILAR TO 'ab.*%' {escape ''}

