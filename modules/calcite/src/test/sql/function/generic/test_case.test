# name: test/sql/function/generic/test_case.test
# description: Test case statement
# group: [generic]

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE test (aa INTEGER, bb INTEGER);

statement ok
INSERT INTO test VALUES (11, 22), (13, 22), (12, 21)

query I
SELECT CASE WHEN test.aa=11 THEN bb ELSE NULL END FROM test
----
22
NULL
NULL

# constant case statements
# all constant
query I
SELECT CASE WHEN 1=1 THEN 1 ELSE NULL END FROM test ORDER BY bb
----
1
1
1

# check + res_if_false constant
query I
SELECT CASE WHEN 1=1 THEN bb ELSE NULL END FROM test ORDER BY bb
----
21
22
22

# check + res_if_true constant
query I
SELECT CASE WHEN 3>2 THEN NULL ELSE bb+1 END FROM test ORDER BY bb
----
NULL
NULL
NULL

# check constant
query I
SELECT CASE WHEN 1=0 THEN bb ELSE bb+1 END FROM test ORDER BY bb
----
22
23
23

# res_if_true and res_if_false constant
query I
SELECT CASE WHEN bb=22 THEN NULL ELSE 1 END FROM test ORDER BY bb
----
1
NULL
NULL

# res_if_false constant
query I
SELECT CASE WHEN bb=22 THEN bb+1 ELSE 1 END FROM test ORDER BY bb
----
1
23
23

# res_if_true constant
query I
SELECT CASE WHEN bb=22 THEN NULL ELSE bb+1 END FROM test ORDER BY bb
----
22
NULL
NULL

# fail case on types that can't be cast to boolean
statement error
SELECT CASE WHEN 'hello' THEN bb ELSE aa END FROM test

# but only when cast cannot be performed
query I
SELECT CASE WHEN 'true' THEN NULL ELSE bb+1 END FROM test ORDER BY bb
----
NULL
NULL
NULL

query I
SELECT CASE WHEN 'false' THEN NULL ELSE bb+1 END FROM test ORDER BY bb
----
22
23
23

