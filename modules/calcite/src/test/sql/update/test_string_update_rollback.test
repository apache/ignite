# name: test/sql/update/test_string_update_rollback.test
# description: Test rollback of string update
# group: [update]

# create aa table
statement ok con1
CREATE TABLE test (aa VARCHAR);

statement ok con1
INSERT INTO test VALUES ('hello'), ('world')

statement ok con1
BEGIN TRANSACTION;

# perform an update within the transaction
statement ok con1
UPDATE test SET aa='test' WHERE aa='hello';

query T con1
SELECT * FROM test ORDER BY aa
----
test
world

query T con2
SELECT * FROM test ORDER BY aa
----
hello
world

# now rollback the update
statement ok con1
ROLLBACK;

query T con1
SELECT * FROM test ORDER BY aa
----
hello
world

query T con2
SELECT * FROM test ORDER BY aa
----
hello
world

# rollback of aa value that is updated twice
statement ok con1
UPDATE test SET aa='test' WHERE aa='hello';

statement ok con1
BEGIN TRANSACTION;

statement ok con1
UPDATE test SET aa='test2' WHERE aa='test';

query T con1
SELECT * FROM test ORDER BY aa
----
test2
world

query T con2
SELECT * FROM test ORDER BY aa
----
test
world

statement ok con1
ROLLBACK;

query T con1
SELECT * FROM test ORDER BY aa
----
test
world

query T con2
SELECT * FROM test ORDER BY aa
----
test
world

# test rollback of string update in different part
statement ok con1
BEGIN TRANSACTION;

statement ok con1
UPDATE test SET aa='test2' WHERE aa='world';

query T con1
SELECT * FROM test ORDER BY aa
----
test
test2

query T con2
SELECT * FROM test ORDER BY aa
----
test
world

statement ok con1
ROLLBACK;

query T con1
SELECT * FROM test ORDER BY aa
----
test
world

query T con2
SELECT * FROM test ORDER BY aa
----
test
world

