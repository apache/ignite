# name: test/sql/update/test_big_table_update.test_slow
# description: Update big table of even and odd values
# group: [update]

# create aa table with the values [0, ..., 3K]
statement ok con1
BEGIN TRANSACTION

statement ok con1
CREATE TABLE test AS SELECT ii AS aa, 'hello' AS bb FROM range (0, 3000, 1) t1(ii);

# insert aa bunch more values
# 3000 -> 6000
statement ok con1
INSERT INTO test SELECT * FROM test

# 6000 -> 12000
statement ok con1
INSERT INTO test SELECT * FROM test

# 12000 -> 24000
statement ok con1
INSERT INTO test SELECT * FROM test

# 24000 -> 48000
statement ok con1
INSERT INTO test SELECT * FROM test

# 48000 -> 96000
statement ok con1
INSERT INTO test SELECT * FROM test

# 96000 -> 192000
statement ok con1
INSERT INTO test SELECT * FROM test

# 192000 -> 384000
statement ok con1
INSERT INTO test SELECT * FROM test

statement ok con1
COMMIT

query RR con1
SELECT SUM(aa), SUM(LENGTH(bb)) FROM test
----
575808000.000000	1920000.000000

query RR con2
SELECT SUM(aa), SUM(LENGTH(bb)) FROM test
----
575808000.000000	1920000.000000

# increment all even values by two
statement ok con1
BEGIN TRANSACTION

statement ok con1
UPDATE test SET aa=aa+2, bb='hellohello' WHERE aa%2=0

query RR con1
SELECT SUM(aa), SUM(LENGTH(bb)) FROM test
----
576192000.000000	2880000.000000

query RR con2
SELECT SUM(aa), SUM(LENGTH(bb)) FROM test
----
575808000.000000	1920000.000000

# now increment all odd values by two
statement ok con1
UPDATE test SET aa=aa+2, bb='hellohello' WHERE aa%2=1

query RR con1
SELECT SUM(aa), SUM(LENGTH(bb)) FROM test
----
576576000.000000	3840000.000000

query RR con2
SELECT SUM(aa), SUM(LENGTH(bb)) FROM test
----
575808000.000000	1920000.000000

# increment all tuples by two now
statement ok con1
UPDATE test SET aa=aa+2, bb='hellohellohellohello'

query RR con1
SELECT SUM(aa), SUM(LENGTH(bb)) FROM test
----
577344000.000000	7680000.000000

query RR con2
SELECT SUM(aa), SUM(LENGTH(bb)) FROM test
----
575808000.000000	1920000.000000

statement ok con1
COMMIT

query RR con1
SELECT SUM(aa), SUM(LENGTH(bb)) FROM test
----
577344000.000000	7680000.000000

query RR con2
SELECT SUM(aa), SUM(LENGTH(bb)) FROM test
----
577344000.000000	7680000.000000

